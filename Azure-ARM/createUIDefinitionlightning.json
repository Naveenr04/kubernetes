{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "resourceTypes": [
            "microsoft.containerservice/managedclusters",
            "microsoft.sql/servers",
            "microsoft.storage/storageaccounts",
            "microsoft.resources/deploymentscripts",
            "microsoft.resources/resourcegroups"
        ],
        "basics": [            
        ],
        "steps": [ {
            "name": "profisee",
            "label": "Profisee",
            "elements": [
                {
                    "name": "ProfiseeVersion",
                    "type": "Microsoft.Common.DropDown",
                    "label": "Version",
                    "defaultValue": "2020R1.1",
                    "toolTip": "Version of the Profisee platform to use.",
                    "constraints": {
                        "required": false,
                        "allowedValues": [
                            {
                                "label": "2020R1.0",
                                "value": "2020R1.0"
                            },
                            {
                                "label": "2020R1.1",
                                "value": "2020R1.1"
                            },
                            {
                                "label": "2020R2.0",
                                "value": "2020R2.0"
                            }
                        ]
                    },
                    "visible": true
                },
                {
                    "name": "ProfiseeAdminUserAccount",
                    "type": "Microsoft.Common.TextBox",
                    "label": "Admin User Account",
                    "defaultValue": "first.last@company.com",
                    "toolTip": "Name of the account of the first super user who will be registered in the Profisee platform, who will be able to logon and add other users.",
                    "constraints": {
                        "required": false,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                },
                {
                    "name": "ProfiseeLicense",
                    "type": "Microsoft.Common.TextBox",
                    "label": "License",
                    "defaultValue": "",
                    "toolTip": "Profisee plaform license string supplied by Profisee support.",
                    "constraints": {
                        "required": true,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                }
            ]
        },
        {
            "name": "ad",
            "label": "Active Direcotry",
            "elements": [ 
                             
                {
                    "name": "ManagedIdentityName",
                    "type": "Microsoft.ManagedIdentity.IdentitySelector",
                    "label": "Managed Identity Configuration",
                    "toolTip": {
                        "systemAssignedIdentity": "Enable system assigned identity to grant the resource access to other existing resources.",
                        "userAssignedIdentity": "Add user assigned identities to grant the resource access to other existing resources."
                    },
                    "defaultValue": {
                        "systemAssignedIdentity": "Off"
                    },
                    "options": {
                        "hideSystemAssignedIdentity": false,
                        "hideUserAssignedIdentity": false
                    }
                }                 
            ]
        },            
        {
            "name": "kubernetes",
            "label": "Kubernetes",
            "elements": [
             
                {
                    "name": "KubernetesLinuxVMSize",
                    "type": "Microsoft.Common.Section",
                    "label": "Linux VM",
                    "elements": [
                        {
                            "name": "vmSize",
                            "type": "Microsoft.Compute.SizeSelector",
                            "label": "Size",
                            "toolTip": "",
                            "recommendedSizes": [
                                "Standard_D2_v3"
                            ],
                            "constraints": {
                                "allowedSizes": []
                            },
                            "options": {
                                "hideDiskTypeFilter": false
                            },
                            "osPlatform": "Linux",
                            "count": 2,
                            "visible": true
                        }
                    ],
                    "visible": true
                },   
                {
                    "name": "KubernetesLinuxNodeCount",
                    "type": "Microsoft.Common.TextBox",
                    "label": "Linux node count",
                    "defaultValue": "1",
                    "toolTip": "Amount of the nodes to create in the Linux node pool.",
                    "constraints": {
                        "required": false,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                },             
                {
                    "name": "KubernetesWindowsNodeSize",
                    "type": "Microsoft.Common.Section",
                    "label": "Windows VM",
                    "elements": [
                        {
                            "name": "vmSize",
                            "type": "Microsoft.Compute.SizeSelector",
                            "label": "Size",
                            "toolTip": "",
                            "recommendedSizes": [
                                "Standard_D4_v3"
                            ],
                            "constraints": {
                                "allowedSizes": []
                            },
                            "options": {
                                "hideDiskTypeFilter": false
                            },
                            "osPlatform": "Windows",
                            "imageReference": {
                                "publisher": "MicrosoftWindowsServer",
                                "offer": "WindowsServer",
                                "sku": "2019-Datacenter"
                            },
                            "count": 2,
                            "visible": true
                        }
                    ],
                    "visible": true
                },
                {
                    "name": "KubernetesWindowsNodeCount",
                    "type": "Microsoft.Common.TextBox",
                    "label": "Linux node count",
                    "defaultValue": "1",
                    "toolTip": "Amount of the nodes to create in the Windows node pool.",
                    "constraints": {
                        "required": false,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                }
            ]
        },        
        {
            "name": "sql",
            "label": "SQL",
            "elements": [
                
                {
                    "name": "SQLServerName",
                    "type": "Microsoft.Common.TextBox",
                    "label": "Server Name",
                    "defaultValue": "mysqlservername",
                    "toolTip": "Enter a unique sql server name.  Can contain only lowercase letters, numbers, and '-', but can't start or end with '-' or have more than 63 characters and be an available sqlserver name in azure.  SQL Server names are globally unique in Azure",
                    "constraints": {
                        "required": false,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                },
                {
                    "name": "SQLServerUser",
                    "type": "Microsoft.Common.TextBox",
                    "label": "User",
                    "defaultValue": "sqladmin",
                    "toolTip": "Administrator SQL login name to create with the new sql server or to use to connect to existing sql server.  Your login name must not contain a SQL Identifier or a typical system name (like admin, administrator, sa, root, dbmanager, loginmanager, etc.) or a built-in database user or role (like dbo, guest, public, etc.).  Your login name must not include non-alphanumeric characters.  Your login name must not start with numbers or symbols",
                    "constraints": {
                        "required": false,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "visible": true
                },
                {
                    "name": "SQLServerPassword",
                    "type": "Microsoft.Common.PasswordBox",
                    "label": {
                        "password": "Password",
                        "confirmPassword": "Confirm password"
                    },
                    "toolTip": "Password for sql server user.  The password does not contain the account name of the user and must be at least eight characters long and be no more than 128 characters in length.  The password contains characters from three of the following four categories: Latin uppercase letters (A through Z).  Latin lowercase letters (a through z).  Base 10 digits (0 through 9).  Non-alphanumeric characters such as: exclamation point (!), dollar sign ($), number sign (#), or percent (%).",
                    "constraints": {
                        "required": true,
                        "regex": "",
                        "validationMessage": ""
                    },
                    "options": {
                        "hideConfirmation": true
                    },
                    "visible": true
                }
            ]
        },  
        {
            "name": "storage",
            "label": "Storage",
            "elements": [
                {
                    "name": "StorageAccountName",
                    "type": "Microsoft.Common.Section",
                    "label": "Storage Account Name",
                    "elements": [
                        {
                            "name": "singleStorage",
                                "type": "Microsoft.Storage.StorageAccountSelector",
                                "label": "Storage account",
                                "toolTip": "",
                                "defaultValue": {
                                    "name": "uniquestorageaccount01",
                                    "type": "Premium_LRS"
                                },
                                "constraints": {
                                    "allowedTypes": []
                                },
                                "options": {
                                    "hideExisting": false
                                },
                                "visible": true
                        }
                    ],
                    "visible": true
                }
            ]
        }],
        "outputs": {
            "ProfiseeVersion": "[steps('profisee').ProfiseeVersion]",
            "ProfiseeAdminUserAccount": "[steps('profisee').ProfiseeAdminUserAccount]",
            "ProfiseeLicense": "[steps('profisee').ProfiseeLicense]",
            "ProfiseeACRUserName": "[steps('profisee').ProfiseeACRUserName]",
            "ProfiseeACRPassword": "[steps('profisee').ProfiseeACRPassword]",
            "ActiveDirectoryCreateApp": "[steps('ad').ActiveDirectoryCreateApp]",
            "ActiveDirectoryClientId": "[steps('ad').ActiveDirectoryClientId]",
            "ManagedIdentityName": "[steps('ad').ManagedIdentityName]",
            "ManagedIdentityResourceGroup": "[steps('ad').ManagedIdentityResourceGroup]",
            "KubernetesClusterName": "[kubernetes('KubernetesClusterName')]",
            "KubernetesLinuxVMSize": "[kubernetes('KubernetesLinuxVMSize')]",
            "KubernetesWindowsVMSize": "[kubernetes('KubernetesWindowsVMSize')]",
            "KubernetesVersion": "[kubernetes('KubernetesVersion')]",
            "KubernetesVnetName": "[kubernetes('KubernetesVnetName')]",
            "KubernetesVnetResourceGroup": "[kubernetes('KubernetesVnetResourceGroup')]",
            "KubernetesSubnetName": "[kubernetes('KubernetesSubnetName')]",
            "KubernetesServiceCidr": "[kubernetes('KubernetesServiceCidr')]",
            "KubernetesDNSServiceIP": "[kubernetes('KubernetesDNSServiceIP')]",
            "KubernetesDockerBridgeCidr": "[kubernetes('KubernetesDockerBridgeCidr')]",
            "SQLServerCreateNew": "[sql('SQLServerCreateNew')]",
            "SQLServerName": "[sql('SQLServerName')]",
            "SQLServerUser": "[sql('SQLServerUser')]",
            "SQLServerPassword": "[sql('SQLServerPassword')]",
            "SQLServerDatabaseName": "[sql('SQLServerDatabaseName')]",
            "StorageAccountCreateNew": "[storage('StorageAccountCreateNew')]",
            "StorageAccountName": "[storage('StorageAccountName')]",
            "StorageAccountAccessKey": "[storage('StorageAccountAccessKey')]",
            "StorageAccountType": "[storage('StorageAccountType')]",
            "StorageAccountFileShareName": "[basistoragecs('StorageAccountFileShareName')]",
            "DNSUpdate": "[dns('DNSUpdate')]",
            "DNSHostName": "[dns('DNSHostName')]",
            "DNSDomainName": "[dns('DNSDomainName')]",
            "DNSDomainResourceGroup": "[dns('DNSDomainResourceGroup')]",
            "HttpsConfigure": "[https('HttpsConfigure')]",
            "HttpsCertificate": "[https('HttpsCertificate')]",
            "HttpsCertificatePrivateKey": "[https('HttpsCertificatePrivateKey')]"
        }
    }
}